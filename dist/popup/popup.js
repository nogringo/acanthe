(()=>{document.addEventListener("DOMContentLoaded",h);var u=document.getElementById("setup-screen"),l=document.getElementById("unlock-screen"),m=document.getElementById("main-screen"),y=document.getElementById("setup-form"),f=document.getElementById("unlock-form"),v=document.getElementById("lock-btn"),d=document.getElementById("passkeys-list"),i=document.getElementById("setup-error"),p=document.getElementById("unlock-error");async function h(){(await n("checkSetup")).isSetup?(await n("isUnlocked")).unlocked?(c("main"),r()):c("unlock"):c("setup"),E()}function c(t){switch(u.classList.add("hidden"),l.classList.add("hidden"),m.classList.add("hidden"),t){case"setup":u.classList.remove("hidden");break;case"unlock":l.classList.remove("hidden");break;case"main":m.classList.remove("hidden");break}}function E(){y.addEventListener("submit",g),f.addEventListener("submit",w),v.addEventListener("click",L)}async function g(t){t.preventDefault();let e=document.getElementById("setup-password").value,s=document.getElementById("setup-confirm").value;if(e!==s){o(i,"Passwords do not match");return}if(e.length<8){o(i,"Password must be at least 8 characters");return}let a=await n("setupMasterPassword",{password:e});a.success?(c("main"),r()):o(i,a.error)}async function w(t){t.preventDefault();let e=document.getElementById("unlock-password").value,s=await n("unlock",{password:e});s.success?(c("main"),r(),document.getElementById("unlock-password").value="",B(p)):o(p,s.error)}async function L(){await n("lock"),c("unlock")}async function r(){let t=await n("getPasskeys");if(!t.success){d.innerHTML='<p class="empty-state">Error loading passkeys</p>';return}if(t.passkeys.length===0){d.innerHTML='<p class="empty-state">No passkeys stored yet.</p>';return}d.innerHTML=t.passkeys.map(e=>`
    <div class="passkey-item" data-id="${e.credentialId}">
      <div class="passkey-info">
        <div class="passkey-site">${k(e.rpName||e.rpId)}</div>
        <div class="passkey-user">${k(e.userDisplayName||e.userName)}</div>
        <div class="passkey-date">${b(e.createdAt)}</div>
      </div>
      <div class="passkey-actions">
        <button class="btn btn-danger delete-btn" data-id="${e.credentialId}">Delete</button>
      </div>
    </div>
  `).join(""),document.querySelectorAll(".delete-btn").forEach(e=>{e.addEventListener("click",I)})}async function I(t){let e=t.target.dataset.id;if(!confirm("Are you sure you want to delete this passkey?"))return;let s=await n("deletePasskey",{credentialId:e});s.success?r():alert("Failed to delete passkey: "+s.error)}function n(t,e={}){return new Promise(s=>{chrome.runtime.sendMessage({action:t,data:e},a=>{s(a||{success:!1,error:"No response"})})})}function o(t,e){t.textContent=e,t.classList.remove("hidden")}function B(t){t.classList.add("hidden")}function k(t){let e=document.createElement("div");return e.textContent=t,e.innerHTML}function b(t){return t?new Date(t).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric"}):"Unknown"}})();
