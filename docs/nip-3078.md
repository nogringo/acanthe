# NIP-3078

## Arbitrary App Data (Regular Events)

`draft` `optional`

This NIP extends [NIP-78](https://github.com/nostr-protocol/nips/blob/master/78.md) to provide a non-replaceable version of application-specific data storage.

## Motivation

NIP-78 defines kind `30078` for application-specific data using parameterized replaceable events (addressable events with `d` tag). While this is useful for many applications, some use cases require:

- **Event history**: Keeping track of all changes over time
- **Conflict resolution**: Merging concurrent updates from multiple devices
- **Audit trail**: Ability to see when and how data changed

Kind `3078` provides the same "app-specific data storage" concept as NIP-78, but using regular events that are never replaced.

## Kind 3078: Regular App Data

| Kind | Range | Behavior |
|------|-------|----------|
| `30078` | 30000-39999 | Addressable (replaced by `d` tag) |
| `3078` | 1000-9999 | Regular (never replaced, history kept) |

### Event Structure

```json
{
  "kind": 3078,
  "pubkey": "<author-pubkey>",
  "created_at": <unix-timestamp>,
  "tags": [
    ["d", "<app-identifier>"],
    ["<custom-tag>", "<value>"],
    ...
  ],
  "content": "<app-specific-data>",
  "sig": "<signature>"
}
```

### Tags

- `d` tag: RECOMMENDED. Contains an identifier for the application. While not used for replacement (unlike kind 30078), it allows filtering events by application.
- Custom tags: Applications can define additional tags for filtering and querying.

### Content

The `content` field can contain any data in any format, as defined by the application. Common formats include:
- Plain text
- JSON
- Encrypted data (e.g., using NIP-44)

## Comparison with NIP-78

| Feature | Kind 30078 (NIP-78) | Kind 3078 (This NIP) |
|---------|---------------------|----------------------|
| Event type | Addressable | Regular |
| History | Replaced (lost) | Preserved |
| Storage | Minimal (1 event per d-tag) | Growing (all events kept) |
| Conflicts | Last write wins | Application handles merge |
| Cleanup | Automatic | Manual (via NIP-09) |

## Use Cases

Kind 3078 is suitable for applications that need:

1. **Version history**: Document revisions, configuration changes
2. **Multi-device sync**: Where concurrent edits must be merged, not overwritten
3. **Audit requirements**: Financial records, access logs
4. **Append-only data**: Activity logs, event streams

## Cleanup

Since events are never automatically replaced, applications should use [NIP-09](https://github.com/nostr-protocol/nips/blob/master/09.md) (Event Deletion) to remove old events when no longer needed:

## Client Behavior

Clients implementing kind 3078 should:

1. **Fetch all events** for the given `d` tag and pubkey
2. **Filter deleted events** by checking for NIP-09 deletion events
3. **Apply application-specific logic** to merge or select the relevant data
4. **Optionally clean up** old events using NIP-09

## Relay Behavior

Relays should treat kind 3078 as regular events:

- Store all events (no automatic replacement)
- Support filtering by `d` tag using `#d` filter
- Honor NIP-09 deletion requests

## Example

An application storing encrypted credentials with history:

```json
{
  "kind": 3078,
  "pubkey": "abc123...",
  "created_at": 1707654321,
  "tags": [
    ["d", "my-credentials-app"]
  ],
  "content": "<nip44-encrypted-content>",
  "sig": "..."
}
```

Fetching all events for the application:
```json
{
  "kinds": [3078],
  "authors": ["abc123..."],
  "#d": ["my-credentials-app"]
}
```

Note: Only single-letter tags are guaranteed to be indexed by relays. Application-specific identifiers should be stored in the (encrypted) content and filtered client-side after decryption.
